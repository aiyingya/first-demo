"use strict";if(!window._base64)var _base64=function(){var e={},a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i=null;return e.encode=function(i){var t,n,l,r,o=e.toUtf8(i),c=-1,s=o.length,u=[,,,];for(t="";++c<s;)n=o[c],l=o[++c],u[0]=n>>2,u[1]=(3&n)<<4|l>>4,isNaN(l)?u[2]=u[3]=64:(r=o[++c],u[2]=(15&l)<<2|r>>6,u[3]=isNaN(r)?64:63&r),t+=a[u[0]]+a[u[1]]+a[u[2]]+a[u[3]];return t},e.toUtf8=function(e){var a,i=-1,t=e.length,n=[];if(/^[\x00-\x7f]*$/.test(e))for(;++i<t;)n.push(e.charCodeAt(i));else for(;++i<t;)a=e.charCodeAt(i),a<128?n.push(a):a<2048?n.push(a>>6|192,63&a|128):n.push(a>>12|224,a>>6&63|128,63&a|128);return n},e.decode=function(a){if(a=a.replace(/\s/g,""),a.length%4)throw new Error("InvalidLengthError: decode failed: The string to be decoded is not the correct length for a base64 encoded string.");if(/[^A-Za-z0-9+\/=\s]/g.test(a))throw new Error("InvalidCharacterError: decode failed: The string contains characters invalid in a base64 encoded string.");var i,t=e.fromUtf8(a),n=0,l=t.length;for(i="";n<l;)i+=t[n]<128?String.fromCharCode(t[n++]):t[n]>191&&t[n]<224?String.fromCharCode((31&t[n++])<<6|63&t[n++]):String.fromCharCode((15&t[n++])<<12|(63&t[n++])<<6|63&t[n++]);return i},e.fromUtf8=function(e){var t,n=-1,l=[],r=[,,,];if(!i){for(t=a.length,i={};++n<t;)i[a.charAt(n)]=n;n=-1}for(t=e.length;++n<t&&(r[0]=i[e.charAt(n)],r[1]=i[e.charAt(++n)],l.push(r[0]<<2|r[1]>>4),r[2]=i[e.charAt(++n)],64!==r[2])&&(l.push((15&r[1])<<4|r[2]>>2),r[3]=i[e.charAt(++n)],64!==r[3]);)l.push((3&r[2])<<6|r[3]);return l},e}();var Prius=function(){var prius={};if(prius.scheme="ymcar://",prius.isInsideApp=!1,prius.isYaomaiche=!1,prius.isCarMaster=!1,prius.clientVersion=null,window.navigator.userAgent){var ua=window.navigator.userAgent.toLocaleLowerCase();if(prius.isInsideApp=ua.indexOf("yuntubrowser",0)!=-1,prius.isYaomaiche=ua.indexOf("yaomaiche",0)!=-1,prius.isCarMaster=ua.indexOf("carmaster",0)!=-1,prius.isAndroid=ua.indexOf("yuntuandroid",0)!=-1,prius.isIOS=ua.indexOf("yuntuios",0)!=-1,prius.isInsideApp){var versionReg=/([\s\S]*)yuntubrowser-(\S*)\/(\S*)(nettype[\S\s]*)/,version=ua.replace(versionReg,"$3");if("#"!==version&&(prius.clientVersion=version),ua.indexOf("deviceid",0)!=-1&&ua.indexOf("pushtoken",0)!=-1){var reg=/([\s\S]*)yuntubrowser-(\S*)\/(\S*)nettype\/(\S*)deviceid\/(\S*)pushtoken\/(\S*)(yuntu[\S\s]*)/,nettype=ua.replace(reg,"$4");"#"!==version&&(prius.netType=nettype);var deviceid=ua.replace(reg,"$5");"#"!==version&&(prius.deviceID=deviceid);var pushtoken=ua.replace(reg,"$6");"#"!==version&&(prius.pushToken=pushtoken)}}}var globalListener={};prius.fireGlobalEvent=function(e,a){globalListener&&e&&globalListener[e]&&globalListener[e].onGlobalEvent(a?JSON.parse(a):"")},prius.nativeFireGlobalEvent=function(e,a){if(e){var i=e?_base64.decode(e):"",t=a?_base64.decode(a):"";prius.fireGlobalEvent(i,t)}},prius.addGlobalEventListener=function(e,a){return!(!e||!a)&&(!!globalListener[e]||(globalListener[e]=a,!0))},prius.removeGlobalEventListener=function(e){return!(!e||!globalListener[e])&&(delete globalListener[e],!0)},prius.nativeExecute=function(e){setTimeout(function(){var a=document.createElement("IFRAME");a.setAttribute("src",e),document.documentElement.appendChild(a),a.parentNode.removeChild(a),a=null},0)},prius.executeActionUrl=function(e,a){var i=prius.scheme+e;a&&(i+="?param="+_base64.encode("string"==typeof a?a:JSON.stringify(a))),prius.nativeExecute(i)};var PATH_LIST=prius.PATH_LIST={LOCATION_CITY:"location/city",LOCATION_ADDRESS:"location/address",LOCATION_COORDINATES:"location/coordinates",SHARE_INFO:"share/info",SHARE_APP:"share/app",PAY_WEIXIN:"pay/weixin",PAY_ALIPAY:"pay/alipay",OPEN_NEW_PAGE:"open/newpage",SHOW_LATENT_INPUT:"app/latentinput",APP_TELEPHONE:"app/telephone",APP_STATISTIC:"app/statistic",APP_TOAST:"app/toast",APP_DIALOG:"app/dialog",APP_SHOW_LOADING:"app/showloading",APP_HIDE_LOADING:"app/hideloading",APP_SHOW_LOADING_DIALOG:"app/showloadingdialog",APP_HIDE_LOADING_DIALOG:"app/hideloadingdialog",MENU_ICON:"menu/icon",MENU_WORD:"menu/word",MENU_SHARE:"menu/share",MENU_DELETE_ALL:"menu/deleteall",USER_LOGIN_IN:"user/loginin",USER_LOGIN_OUT:"user/loginout",USER_LOGIN:"user/login",USER_BIND:"user/bind",PAGE_HOME:"page/home",PAGE_MYINFO:"page/userinfo",PAGE_LOGIN:"page/login",PAGE_REGIST:"page/regist",PAGE_URL_OVERRIDE:"page/urloverride",PAGE_END:"page/end",PAGE_CITY:"page/selectCity",PAGE_STORE:"page/selectStore",PAGE_REQUEST:"page/request",HEAD_SETTAPHEAD:"head/settaphead",HEAD_SETLISTHEAD:"head/setlisthead",HEAD_SET_DOCTITLE:"head/setdoctitle",GOTO_BACK:"goto/back"},callbackList={};prius.addCallback=function(e){return!!(e&&e.callId&&callbackList)&&(callbackList[e.callId]=e,console.log(callbackList),!0)},prius.removeClientCall=function(e){return!!(e&&e.callId&&callbackList&&callbackList[e.callId])&&(delete callbackList[e.callId],!0)},prius.onCallbackDone=function(e){if(e){var a=JSON.parse(_base64.decode(e));if(a&&a.callId){var i=callbackList[a.callId];if(i&&i.onSuccess){var t=a.data||"";return void i.onSuccess(t)}console.log("Callbackdone is null or CallbackDone.onSuccess is null!")}else console.log("CallbackDone.callId is null!")}console.log("Fail onCallbackDone, something wrong can't callback!")},prius.onCallbackFail=function(e){if(e){var a=JSON.parse(_base64.decode(e));if(a&&a.callId){var i=callbackList[a.callId];if(i&&i.onFail)return void i.onFail(a.data||"");console.log("CallbackFail is null or CallbackDone.onFail is null!")}else console.log("CallbackFail.callId is null!")}console.log("Fail onCallbackFail, something wrong can't callback!")},prius.onCallbackCancel=function(e){if(e){var a=JSON.parse(_base64.decode(e));if(a&&a.callId){var i=callbackList[a.callId];if(i&&i.onCancel)return void i.onCancel(a.data||"");console.log("CallbackCancel is null or CallbackDone.onCancel is null!")}else console.log("CallbackCancel.callId is null!")}console.log("Fail onCallbackCancel, something wrong can't callback!")};var addCallbackListener=function(e,a){if(!e)return console.log("Fail addCallback listener, callId is null"),!1;if(!a)return console.log("Fail addCallback listener, callback listener is null"),!1;var i={callId:e,onSuccess:a.onSuccess,onCancel:a.onCancel,onFail:a.onFail};prius.addCallback(i)};prius.dialPhone=function(e){if(e){var a={callId:PATH_LIST.APP_TELEPHONE,data:{tel:e||""}};prius.executeActionUrl(PATH_LIST.APP_TELEPHONE,a)}},prius.showToast=function(e){var a={};"string"==typeof e?a.msg=e:a.msg=e.msg;var i={callId:PATH_LIST.APP_TOAST,data:{content:a.msg||""}};prius.executeActionUrl(PATH_LIST.APP_TOAST,i)},prius.showDialog=function(e,a){if(a=a||{},e&&a){var i={callId:PATH_LIST.APP_DIALOG,data:{title:e.title||"",content:e.content||"",button1Name:e.button1Name||"",button2Name:e.button2Name||"",one2Success:e.one2Success||"1"}};addCallbackListener(PATH_LIST.APP_DIALOG,a),prius.executeActionUrl(PATH_LIST.APP_DIALOG,i)}},prius.showLoadingView=function(e){var a={callId:PATH_LIST.APP_SHOW_LOADING,data:{content:e||""}};prius.executeActionUrl(PATH_LIST.APP_SHOW_LOADING,a)},prius.hideLoadingView=function(){var e={callId:PATH_LIST.APP_HIDE_LOADING};prius.executeActionUrl(PATH_LIST.APP_HIDE_LOADING,e)},prius.showLoadingDialog=function(e){var a={callId:PATH_LIST.APP_SHOW_LOADING_DIALOG,data:{content:e||""}};prius.executeActionUrl(PATH_LIST.APP_SHOW_LOADING_DIALOG,a)},prius.hideLoadingDialog=function(){var e={callId:PATH_LIST.APP_HIDE_LOADING_DIALOG};prius.executeActionUrl(PATH_LIST.APP_HIDE_LOADING_DIALOG,e)},prius.getLocationCity=function(e){e=e||{},addCallbackListener(PATH_LIST.LOCATION_CITY,e);var a={callId:PATH_LIST.LOCATION_CITY};prius.executeActionUrl(PATH_LIST.LOCATION_CITY,a)},prius.getLocationAddress=function(e){e=e||{},addCallbackListener(PATH_LIST.LOCATION_ADDRESS,e);var a={callId:PATH_LIST.LOCATION_ADDRESS};prius.executeActionUrl(PATH_LIST.LOCATION_ADDRESS,a)},prius.getCoordinates=function(e){e=e||{},addCallbackListener(PATH_LIST.LOCATION_COORDINATES,e);var a={callId:PATH_LIST.LOCATION_COORDINATES};prius.executeActionUrl(PATH_LIST.LOCATION_COORDINATES,a)},prius.shareInfo=function(e,a,i,t,n){n=n||{},addCallbackListener(PATH_LIST.SHARE_INFO,n);var l={callId:PATH_LIST.SHARE_INFO,data:{title:e||"",content:a||"",link:i||"",ext:t}};prius.executeActionUrl(PATH_LIST.SHARE_INFO,l)},prius.shareInfoWithImg=function(title,imgLink,content,link,ext,listener,type,productId){listener=listener||{},link&&site.globalService.getUserId("ymc_userkey")&&(link=link.match(/(\?|&)shareKey=([^&]*)/)?link.replace(eval("/(shareKey=)([^&]*)/gi"),"shareKey="+site.globalService.getUserId("ymc_userkey")):link.indexOf("?")==-1?link+"?shareKey="+site.globalService.getUserId("ymc_userkey"):link+"&shareKey="+site.globalService.getUserId("ymc_userkey")),link&&link.indexOf("?")==-1&&(link=link+"?randomId="+ +new Date),addCallbackListener(PATH_LIST.SHARE_INFO,listener);var params={callId:PATH_LIST.SHARE_INFO,data:{title:title||"",content:content||"",link:link||"",imgLink:imgLink||"",ext:ext}};type&&productId&&(params.data.type=type,params.data.originId=productId),prius.executeActionUrl(PATH_LIST.SHARE_INFO,params)},prius.wechatPay=function(e,a){a=a||{},addCallbackListener(PATH_LIST.PAY_WEIXIN,a);var i={callId:PATH_LIST.PAY_WEIXIN,data:e||{}};prius.executeActionUrl(PATH_LIST.PAY_WEIXIN,i)},prius.aliPay=function(e,a){a=a||{},addCallbackListener(PATH_LIST.PAY_ALIPAY,a);var i={callId:PATH_LIST.PAY_ALIPAY,data:e||{}};prius.executeActionUrl(PATH_LIST.PAY_ALIPAY,i)};var lastOpenTime=0;return prius.openNewPage=function(e){var a=(new Date).getTime();if(!(a-lastOpenTime<500)){lastOpenTime=a;var i={callId:PATH_LIST.OPEN_NEW_PAGE,data:{title:e.title||"",link:e.linkUrl||"",showTitle:e.showTitle||"0",pageidentifier:e.pageidentifier||"0"}};prius.executeActionUrl(PATH_LIST.OPEN_NEW_PAGE,i)}},prius.uploadUBTStatistic=function(e){var a={callId:PATH_LIST.APP_STATISTIC,data:{ubtData:e||""}};prius.executeActionUrl(PATH_LIST.APP_STATISTIC,a)},prius.appLoginIn=function(e,a,i){var t={callId:PATH_LIST.USER_LOGIN_IN,data:{token:e||"",userId:a||"",userName:i||""}};prius.executeActionUrl(PATH_LIST.USER_LOGIN_IN,t)},prius.appLoginOut=function(){var e={callId:PATH_LIST.USER_LOGIN_OUT};prius.executeActionUrl(PATH_LIST.USER_LOGIN_OUT,e)},prius.login=function(e){e=e||{};var a=PATH_LIST.USER_LOGIN+(new Date).getTime();addCallbackListener(a,e);var i={callId:a};prius.executeActionUrl(PATH_LIST.USER_LOGIN,i)},prius.gotoHomePage=function(){var e={callId:PATH_LIST.PAGE_HOME};prius.executeActionUrl(PATH_LIST.PAGE_HOME,e)},prius.gotoLoginPage=function(e){e=e||{},addCallbackListener(PATH_LIST.PAGE_LOGIN,e);var a={callId:PATH_LIST.PAGE_LOGIN};prius.executeActionUrl(PATH_LIST.PAGE_LOGIN,a)},prius.gotoRegistPage=function(e){e=e||{},addCallbackListener(PATH_LIST.PAGE_REGIST,e);var a={callId:PATH_LIST.PAGE_REGIST};prius.executeActionUrl(PATH_LIST.PAGE_REGIST,a)},prius.gotoMyInfoPage=function(){var e={callId:PATH_LIST.PAGE_MYINFO};prius.executeActionUrl(PATH_LIST.PAGE_MYINFO,e)},prius.shouleOverrideUrl=function(e,a,i,t,n,l){var r=PATH_LIST.PAGE_URL_OVERRIDE+(new Date).getTime();prius.addCallback({callId:r,onSuccess:function(a){console.log("shouleOverideUrl onSuccess: "+e),l(!0,a)},onCancel:function(a){console.log("shouleOverideUrl onCancel: "+e),l(!1,a)},onFail:function(a){console.log("shouleOverideUrl onFail: "+e),l(!1,a)}});try{prius.executeActionUrl(PATH_LIST.PAGE_URL_OVERRIDE,{callId:r,data:{toUrl:e,to:a,from:i,toQuery:n,fromQuery:t}})}catch(e){console.log("catch onFail: "+url),l(!1)}},prius.pageEnd=function(){var e={callId:PATH_LIST.PAGE_END};prius.executeActionUrl(PATH_LIST.PAGE_END,e)},prius.sendPageRequest=function(e){e||(e={});var a={callId:PATH_LIST.PAGE_REQUEST,data:{title:e.title||"",pageId:e.pageId||"",backPageId:e.backPageId||"",lastPageId:e.lastPageId||"",background:e.background||""}};prius.executeActionUrl(PATH_LIST.PAGE_REQUEST,a)},prius.isVersionLessV2=function(){var e=Prius.clientVersion;return!e||!(+e.slice(0,1)>=2)},prius.bindUserAccount=function(e){var a={callId:PATH_LIST.USER_BIND,data:e||{}},i=prius.scheme+PATH_LIST.USER_BIND;a&&(i+="?param="+_base64.encode("string"==typeof a?a:JSON.stringify(a))),i&&(window.location=i)},prius.addShareMenu=function(e){var a={callId:PATH_LIST.MENU_SHARE,data:{title:e.title||"",content:e.content||"",link:e.link||"",imgLink:e.imgLink||""}};prius.executeActionUrl(PATH_LIST.MENU_SHARE,a)},prius.addIconMenu=function(e,a){a=a||{};var i=PATH_LIST.MENU_ICON+(new Date).getTime();addCallbackListener(i,a);var t={callId:i,data:{iconUrl:e.iconUrl||"",rule:e.rule||"1"}};prius.executeActionUrl(PATH_LIST.MENU_ICON,t)},prius.addWordMenu=function(e,a){a=a||{};var i=PATH_LIST.MENU_WORD+(new Date).getTime();addCallbackListener(i,a);var t={callId:i,data:{word:e.word||"",rule:e.rule||"1"}};prius.executeActionUrl(PATH_LIST.MENU_WORD,t)},prius.deleteMenu=function(e){var a={callId:PATH_LIST.MENU_DELETE_ALL,data:{rule:e.rule||"1"}};prius.executeActionUrl(PATH_LIST.MENU_DELETE_ALL,a)},prius.showLatentInput=function(e,a){a=a||{};var i=PATH_LIST.SHOW_LATENT_INPUT;addCallbackListener(i,a);var t={callId:i,data:{openID:e.openID||"",weixinName:e.weixinName||""}};prius.executeActionUrl(PATH_LIST.SHOW_LATENT_INPUT,t)},prius.selectCity=function(e,a){a=a||{},addCallbackListener(PATH_LIST.PAGE_CITY,a);var i={callId:PATH_LIST.PAGE_CITY,data:{provinceId:e.provinceId,provinceName:e.provinceName,cityId:e.cityId,cityName:e.cityName,townId:e.townId,town:e.town,cityType:e.cityType,saveType:e.saveType}};prius.executeActionUrl(PATH_LIST.PAGE_CITY,i)},prius.selectStore=function(e,a){a=a||{},addCallbackListener(PATH_LIST.PAGE_STORE,a);var i={callId:PATH_LIST.PAGE_STORE,data:{storeId:e.storeId,storeName:e.storeName}};prius.executeActionUrl(PATH_LIST.PAGE_STORE,i)},prius.setTapHead=function(e){var a=e.items,i=e.styles,t=[],n={};if(!a||a.length<=0)return void onsole.log("tap is null!");for(var l=0;l<a.length;l++)t[l]={name:a[l].tap,code:l.toString(),url:a[l].url||"",active:a[l].active||0},n[l]={callback:a[l].tapaction,callid:l};var r=PATH_LIST.HEAD_SETTAPHEAD+(new Date).getTime(),o={callId:r,data:{items:t,styles:i}},c={onSuccess:function(e){var a=(e.code,n[e.code]);return e.code!==a.callid.toString()||"function"!=typeof a.callback?void console.log("tapaction is not a function or tapaction is null!"):void a.callback()}};addCallbackListener(r,c),prius.executeActionUrl(PATH_LIST.HEAD_SETTAPHEAD,o)},prius.setListHead=function(e){var a=e.items,i=e.styles,t=[],n={};if(!a||a.length<=0)return void onsole.log("list is null!");for(var l=0;l<a.length;l++)t[l]={name:a[l].list,code:l.toString(),url:a[l].url||""},n[l]={callback:a[l].listaction,callid:l};var r=PATH_LIST.HEAD_SETLISTHEAD+(new Date).getTime(),o={callId:r,data:{items:t,styles:i}},c={onSuccess:function(e){var a=(e.code,n[e.code]);return e.code!==a.callid.toString()||"function"!=typeof a.callback?void console.log("listaction is not a function or listaction is null!"):void a.callback()}};addCallbackListener(r,c),prius.executeActionUrl(PATH_LIST.HEAD_SETLISTHEAD,o)},prius.goBackToPage=function(e){var a={pageidentifier:e.pageidentifier};prius.executeActionUrl("goto/back",a)},prius.setDocTitle=function(e){var a={callId:PATH_LIST.HEAD_SET_DOCTITLE,data:{title:e.title}};prius.executeActionUrl("head/setdoctitle",a)},prius}();window.Prius=module.exports=Prius;